
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if a user is an authenticated staff member (doctor or nurse)
    function isStaff() {
      return request.auth != null && (request.auth.token.role == 'doctor' || request.auth.token.role == 'nurse');
    }

    // Doctors can fully manage their own profiles.
    // Nurses can read doctor profiles.
    match /doctors/{doctorId} {
      allow read: if isStaff();
      allow write: if request.auth.uid == doctorId;
    }

    // Nurses can fully manage their own profiles.
    // Doctors can read nurse profiles.
    match /nurses/{nurseId} {
      allow read: if isStaff();
      allow write: if request.auth.uid == nurseId;
    }

    // Staff can create, read, update, and delete patient records.
    // Anyone can read patient data for status checks.
    match /patients/{patientId} {
      allow read: if true;
      allow write: if isStaff();
    }

    // Staff can manage clinic-wide settings and messages.
    // Anyone can read this information.
    match /clinicInfo/{docId} {
      allow read: if true;
      allow write: if isStaff();
    }
  }
}
